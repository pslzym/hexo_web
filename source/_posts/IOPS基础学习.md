---
title: IOPS基础学习
tags: |-

  - Linux操作运维
permalink: iopsji-chu-xue-xi
id: 18
updated: '2016-09-22 14:05:47'
date: 2016-09-22 14:03:11
---


机械硬盘的连续读写性能很好，但是随机读写的性能很差。随机读写时磁头的移动和寻道会发费很多时间。

iops--磁盘性能指标：每秒输入输出量（读写次数）
-----------------------------------------
	单位时间内系统处理i/o请求的数量，一般以每秒io请求次数为单位。
	随机读写瓶颈的应用，如小文件存储（图片）、数据库、邮件服务、很关注读写性能，iops是关键的衡量指标。
	顺序读写频繁的应用，传输大量连续的数据，如电视台视频编辑、视频点播、关注连续读写性能。数据吞吐量是关键衡量指标。
	
IOPS和数据吞吐量适用于不同的场合：

	读取10000个1KB文件，用时10秒  Throught(吞吐量)=1MB/s ，IOPS=1000  追求IOPS
	读取1个10MB文件，用时0.2秒  Throught(吞吐量)=50MB/s, IOPS=5  追求吞吐量

HDD 磁盘服务时间：

	完成一次io的时间：寻道时间+旋转延迟+数据传输。三部分构成
	寻道时间 Tseek将磁头移动到正确的磁道上所花费的时间。一般在3-15ms
	旋转延迟Trotation将数据移动至磁头下方的时间。与转速有关。7200rpm-4.17ms   15000rpm--2ms
	数据传输时间Ttransfer指传输所请求数据所需要的时间，它取决于数据传输的速率。ATA可达133MB/s,SATA--300MB/s。时间可忽略。

	常见硬盘的旋转延迟时间为：
	7200   rpm的磁盘平均旋转延迟大约为60*1000/7200/2 = 4.17ms
	10000 rpm的磁盘平均旋转延迟大约为60*1000/10000/2 = 3ms，
	15000 rpm的磁盘其平均旋转延迟约为60*1000/15000/2 = 2ms。


最大IOPS的理论计算方法
--------------------------------------
	IOPS = 1000 ms/ (寻道时间 + 旋转延迟)。可以忽略数据传输时间。
	
	7200   rpm的磁盘 IOPS = 1000 / (9 + 4.17)  = 76 IOPS
	10000 rpm的磁盘IOPS = 1000 / (6+ 3) = 111 IOPS
	15000 rpm的磁盘IOPS = 1000 / (4 + 2) = 166 IOPS

影响测试的因素
-----------------------------------------

	实际测量中，IOPS数值会受到很多因素的影响，包括I/O负载特征(读写比例，顺序和随机，工作线程数，队列深度，数据记录大小)、系统配置、操作系统、磁盘驱动等等。因此对比测量磁盘IOPS时，必须在同样的测试基准下进行，即便如此也会产生一定的随机不确定性。

队列深度说明 
	NCQ、SCSI TCQ、PATA TCQ和SATA TCQ技术解析 
----------------------------------------
    是一种命令排序技术，一把喂给设备更多的IO请求，让电梯算法和设备有机会来安排合并以及内部并行处理，提高总体效率。

SCSI TCQ的队列深度支持256级
ATA TCQ的队列深度支持32级 （需要8M以上的缓存）
NCQ最高可以支持命令深度级数为32级，NCQ可以最多对32个命令指令进行排序。

    大多数的软件都是属于同步I/O软件，也就是说程序的一次I/O要等到上次I/O操作的完成后才进行，这样在硬盘中同时可能仅只有一个命令，也是无法发挥这个技术的优势，这时队列深度为1。
    随着Intel的超线程技术的普及和应用环境的多任务化，以及异步I/O软件的大量涌现。这项技术可以被应用到了，实际队列深度的增加代表着性能的提高。
在测试时，队列深度为1是主要指标，大多数时候都参考1就可以。实际运行时队列深度也一般不会超过4.


参考连接：
	
	http://elf8848.iteye.com/blog/1731274
	http://elf8848.iteye.com/blog/1731301
    fio 使用学习连接：
    https://www.ustack.com/blog/how-benchmark-ebs/
    https://segmentfault.com/a/1190000003880571
    http://elf8848.iteye.com/blog/2168876 
